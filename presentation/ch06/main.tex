%include part: see main.beamer.tex and main.article.tex
%include part: see main.beamer.tex and main.article.tex
%include common packages and settings
\input{./../common}


\title{Реляционная алгебра}


\begin{document}

%титул и содержание статьи
\mode<article>{\maketitle\tableofcontents}

%титул и содержание презентации
\frame<presentation>{\titlepage}
\begin{frame}<presentation>
    \frametitle{Содержание}
    \tableofcontents
\end{frame}


\section{Реляционная алгебра}


\subsection{Определения}

\begin{frame}
    \frametitle{Определения}
    
    \begin{definition}
        Два отношения $P_1$ и $P_2$, имеющие одинаковую \alert{арность}\footnote{Т.е., если оба отношения $P_1,P_2$ являются $n$-арными}, называются \alert{совместимыми}.
    \end{definition}
    
    \begin{definition}
        Если
        \[P\subseteq A_1\times A_2\times\ldots\times A_n,\]
        то $A_i$ называется $i$-м \alert{доменом} отношения $P$.
    \end{definition}
\end{frame}


\subsection{Операции реляционной алгебры}

\begin{frame}
    \frametitle{Операции над отношениями}
    
    Унарные над $P$.
    \begin{enumerate}
        \item \alert{Выбор}. $\textit{Выбор}(P,c)$.
        \item \alert{Проекция}. $\textit{Проекция}(P/(D_1,D_2,\ldots,D_m))$.
    \end{enumerate}
    
    Бинарные над $P_1,P_2$.
    \begin{enumerate}
        \item Для \alert{совместимых} отношений $P_1$ и $P_2$ применимы операции алгебры множеств:
        \begin{enumerate}
            \item \alert{объединение} $P_1\cup P_2$;
            \item \alert{пересечение} $P_1\cap P_2$;
            \item \alert{разность} $P_1\backslash P_2$.
        \end{enumerate}
        \item \alert{Расширенное декартово произведение} двух отношений $P_1\times P_2$.
        \item \alert{Соединение}. $\textit{Соединение}(P_1,P_2,C)$.
    \end{enumerate}
\end{frame}

\begin{frame}
    \frametitle{Унарные операции}
    \framesubtitle{Выбор. $P\subseteq A_1\times A_2\times\ldots\times A_n$}
    
    \[
        \begin{split}
            \textit{Выбор}(P,c)=\\
            =\{(a_1,a_2,\ldots,a_n)|(a_1,a_2,\ldots,a_n)\in P \land c(a_1,a_2,\ldots,a_n)\},
        \end{split}
    \]
    где $c$ --- условие, накладываемое на значение переменных кортежа. Операция \alert{выбора} получает подмножество всех кортежей $P$, удовлетворяющих условию $c$.
\end{frame}

\begin{frame}
    \frametitle{Унарные операции}
    \framesubtitle{Проекция. $P\subseteq A_1\times A_2\times\ldots\times A_n$}
    
    Пусть задана функция
    \[ f:\{1,2,\ldots,m\}\to\{1,2,\ldots,n\}. \]
    Тогда
    \[
        \begin{split}
            \textit{Проекция}(P/(A_{f(1)},A_{f(2)},\ldots,A_{f(m)}))=\\
            =\{(a_{f(1)},a_{f(2)},\ldots,a_{f(m)})|(a_1,a_2,\ldots,a_n)\in P\}.
        \end{split}
    \]
    
    Операция \alert{проекции} переставляет, дублирует или убирает некоторые домены исходного отношения $P$.
\end{frame}

\begin{frame}
    \frametitle{Бинарные операции}
    \framesubtitle{Расширенное декартово произведение. $P_1\times P_2$}
    
    \[
        \begin{split}
            P_1\times P_2=\\
            =\{(a_1,\ldots,a_m,b_1,\ldots,b_n)|(a_1,\ldots,a_m)\in P_1 \land (b_1,\ldots,b_n)\in P_2\}.
        \end{split}
    \]
\end{frame}
    
\begin{frame}
    \frametitle{Бинарные операции}
    \framesubtitle{Соединение}

    \[
        \begin{split}
            \textit{Соединение}(P_1, P_2, c)=\textit{Выбор}(P_1\times P_2, c),
        \end{split}
    \]
    где $c$ --- условие, накладываемое на кортежи $P_1\times P_2$.
\end{frame}

\begin{frame}
    \frametitle{Примеры}

    \begin{example}
        Пусть $P_1\subseteq A_1\times A_2$:
        \[
            P_1=\{(a,1),(a,2),(b,3),(c,4)\}.
        \]
        Найти $\textit{Выбор}(P_1,A_1=a)$, $\textit{Выбор}(P_1,A_2>2)$, $\textit{Выбор}(P_1,A_1=A_2)$.

    \end{example}
    
    \begin{proof}<2>[Решение]
        \begin{tabular}{l}
            $\textit{Выбор}(P_1,A_1=a)=\{(a,1),(a,2)\}$,\\
            $\textit{Выбор}(P_1,A_2>2)=\{(b,3),(c,4)\}$,\\
            $\textit{Выбор}(P_1,A_1=A_2)=\emptyset$.
        \end{tabular}
    \end{proof}
\end{frame}
    
\begin{frame}
    \frametitle{Примеры}

    \begin{example}
        Пусть $P_1\subseteq A_1\times A_2, P_2\subseteq B_1\times B_2\times B_3$:
        \[
            \begin{split}
                P_1=\{(a,1),(a,2),(b,3),(c,4)\},\\
                P_2=\{(a,\lambda,2),(b,\beta,3)\}.
            \end{split}
        \]
        Найти  $\textit{Проекция}(P_1/A_1)$, $\textit{Проекция}(P_2/(B_1,B_3))$, $\textit{Проекция}(P_2/(B_3,B_2,B_1))$.
    \end{example}
    
    \begin{proof}<2>[Решение]
        \begin{tabular}{l}
            $\textit{Проекция}(P_1/A_1)=\{a,b,c\}$,                               \\
            $\textit{Проекция}(P_2/(B_1,B_3))=\{(a,2),(b,3)\}$,                   \\            
            $\textit{Проекция}(P_2/(B_3,B_2,B_1))=\{(2,\lambda,a),(3,\beta,b)\}$. \\
        \end{tabular}
    \end{proof}
\end{frame}

\begin{frame}
    \frametitle{Примеры}

    \begin{example}[Найти расширенное декартово произведение]
        Пусть $P_1\subseteq A_1\times A_2, P_2\subseteq B_1\times B_2\times B_3$:
        \[
            \begin{split}
                P_1=\{(a,1),(a,2),(b,3),(c,4)\},\\
                P_2=\{(a,\lambda,2),(b,\beta,3)\}.
            \end{split}
        \]
    \end{example}
    
    \begin{proof}<2>[Решение]
        \[
            \begin{split}
                P_1\times P_2=\{
                    (a,1,a,\lambda,2),(a,1,b,\beta,3),
                    (a,2,a,\lambda,2),(a,2,b,\beta,3),\\
                    (b,3,a,\lambda,2),(b,3,b,\beta,3), 
                    (c,4,a,\lambda,2),(c,4,b,\beta,3)
                \}.
            \end{split}
        \]
    \end{proof}
\end{frame}

\begin{frame}
    \frametitle{Примеры}

    \begin{example}
        Пусть $P_1\subseteq A_1\times A_2, P_2\subseteq B_1\times B_2\times B_3$:
        \begin{align*}
            P_1=\{(a,1),(a,2),(b,3),(c,4)\}, & & P_2=\{(a,\lambda,2),(b,\beta,3)\}.
        \end{align*}
        Найти: $\textit{Соединение}(P_1,P_2,A_1=B_1)$, $\textit{Соединение}(P_1,P_2,(A_1=B_1\land A_2=B_3))$, $\textit{Соединение}(P_1,P_2,(A_2>2\land B_3>2))$.
    \end{example}
    
    \begin{proof}<2>[Решение]
        \begin{tabular}{l}
            \(
                \textit{Соед-е}(P_1,P_2,A_1=B_1)=\{
                    (a,1,a,\lambda,2),
                    (a,2,a,\lambda,2),
                    (b,3,b,\beta,3)                     
                \}
            \)\\
            \(
                \textit{Соед-е}(P_1,P_2,(A_1=B_1\land A_2=B_3))=\{
                    (a,2,a,\lambda,2),
                    (b,3,b,\beta,3)                     
                \}
            \)\\
            \(
                \textit{Соед-е}(P_1,P_2,(A_2>2\land B_3>2))=\{
                    (b,3,b,\beta,3),(c,4,b,\beta,3)
                \}
            \)\\
        \end{tabular}
    \end{proof}
\end{frame}

\begin{frame}
    \frametitle{Примеры}

    \begin{example}
        Пусть $P_1\subseteq A_1\times A_2, P_2\subseteq B_1\times B_2\times B_3$:
        \[
            \begin{split}
                P_1=\{(a,1),(a,2),(b,3),(c,4)\},\\
                P_2=\{(a,\lambda,2),(b,\beta,3)\}.
            \end{split}
        \]
        Найти: $\textit{Выбор}(\textit{Соединение}(P_1,P_2,A_1=B_1), A_2<B_3))$
    \end{example}
    
    \begin{proof}<2>[Решение]
        $\textit{Выбор}(\textit{Соединение}(P_1,P_2,A_1=B_1), A_2<B_3)=\{(a,1,a,\lambda,2)\}$
    \end{proof}
\end{frame}



\section{Реляционные базы данных. Основы SQL}

Задача сбора, хранения и обработки данных настолько распространена, что со временем появились специальные программные системы, решающие эти задачи --- СУБД. СУБД --- система управления базой данных. Прикладные программы, которым требуется работа с большими объемами данных, общаются с СУБД через программный интерфейс, позволяющий им задавать структуру базы данных, сохранять, удалять и выбирать необходимые данные, не заботясь о том, как именно решаются эти сложные подзадачи. 

Системы управления реляционными базами данных получили широкое распространение. Прилагательное \emph{реляционная} (relation --- отношение) означает то, что данные представлены отношениями. Отношению в реляционной базе данных соответствует таблица с соответствующим именем, а доменам отношения --- имена столбцов (см. например, рис. \ref{tbl:ralg:Student}). Собственно реляционная база данных --- это также именованная сущность, состоящая (упрощенно) из нескольких таблиц.

Как прикладная программа взаимодействует с реляционной СУБД? Посредством текстовых запросов на специализированном языке SQL. SQL --- Structured Query Language (язык структурированных запросов\footnote{SQL --- язык четвертого поколения: представитель узко специализированных языков высокого уровня}). Прикладная программа посылает базе данных запрос\footnote{Запрос может быть послан, например, по сети, если СУБД и прикладная программа исполняются на разных компьютерах}, содержащий предложение SQL и получает ответ. Типы предложений на SQL могут быть разные: 
\begin{itemize}
    \item создать(удалить) базу данных с некоторым уникальным именем;
    \item создать(удалить,модифицировать) таблицу с уникальным именем в пределах конкретной базы данных;
    \item записать(удалить,модифицировать) данные в таблицу базы данных;
    \item выбрать данные из одной или нескольких таблиц;
    \item создать/удалить пользователя базы данных;
    \item и т.д.
\end{itemize}

Разные будут и ответы на запросы. Далее будует рассмотрена лишь малая часть языка SQL, касающаяся выборки данных. Эта часть языка полностью реализует операции реляционной алгебры, и в качестве ответа на запрос, прикладной программе передается таблица\footnote{Более того, возможности SQL по выборке данных выходят за пределы реляционной алгебры, например некоторые столбцы результирующей таблицы могут быть \emph{вычислены}}. Необходимо отметить, что разноименные таблицы могут иметь столбцы с одинаковыми именами, при этом к столбцу $x$ таблицы $T$ можно обратиться $T.x$.

Существует стандарт на язык SQL, а это значит, что с различными СУБД\footnote{Конечно, поддерживающими стандарт!}, прикладная программа может <<разговаривать>> на одном языке.

\subsection{Хранение отношений в таблицах}

\begin{frame}
    \frametitle{Хранение отношений в таблицах}
    
    \begin{table}[!ht]
        \caption{Студент}
        \resizebox{\textwidth}{!}{
            \begin{tabular}{|l|l|l|l|l|l|}
                \hline\hline
                Номер & Фамилия         & Имя           & Отчество      & ДеньРожд   & Пол\\
                \hline\hline
                2001  & Иванов          & Иван          & Иванович      & 28.02.1991 & М\\
                2002  & Александрова    & Александра    & Александровна & 07.05.1992 & Ж\\
                2003  & Петров          & Петр          & Петрович      & 23.12.1982 & М\\
                2004  & Евгеньева       & Евгения       & Евгеньевна    & 13.11.1981 & Ж\\
                2005  & Сидоров         & Сидор         & Сидорович     & 30.07.1989 & М\\
                2006  & Валентинова     & Валентина     & Валентиновна  & 17.01.1992 & Ж\\
                2007  & Ильин           & Илья          & Ильич         & 03.10.1985 & М\\
                \hline
            \end{tabular}
        }
    \end{table}
\end{frame}

\begin{frame}
    \frametitle{Хранение отношений в таблицах}

    \begin{table}[!ht]
        \caption{Секция}
        \begin{tabular}{|l|l|l|}
            \hline\hline
            Номер   & Название  & Плата\\
            \hline\hline
            1       & Теннис    & 2000\\
            2       & Футбол    & 1000\\
            3       & Волейбол  & 800\\
            4       & Сумо      & 1500\\
            5       & Бокс      & 600\\
            \hline
        \end{tabular}
    \end{table}
\end{frame}

\begin{frame}
    \frametitle{Хранение отношений в таблицах}

    \begin{table}[!ht]
        \caption{СекцияСтудента}
        \begin{tabular}{|l|l|}
            \hline\hline
            НомерСекции     & НомерСтудента \\
            \hline\hline
            1               & 2001\\
            1               & 2007\\
            2               & 2002\\
            3               & 2006\\
            4               & 2004\\
            4               & 2003\\
            5               & 2001\\
            \hline
        \end{tabular}
    \end{table}
\end{frame}

\subsection{SQL SELECT}
Проведем аналогии между основными операциями реляционной алгебры и SQL. Все возможности реляционной алгебры заключаются в одном операторе SQL, который имеет следующую структуру\footnote{Структура запроса сильно упрощена}:

\begin{frame}[fragile]
    \frametitle{SQL. Оператор \verb"select"}
    
\begin{semiverbatim}
\alert{select} <имена столбцов таблиц проекции>
\alert{from}   <имена таблиц-источников>
\alert{where}  <условие выбора>
\end{semiverbatim}

    \verb"select" --- <<выбрать>>; \verb"from" --- <<из>>; \verb"where" --- <<где>>. После ключевого слова \verb"from" через запятую перечисляются имена таблиц-источников (т.е. отношений $T_1,T_2,\ldots,T_n$), после ключевого слова \verb"where" следует условие \alert{выбора}, накладываемое на кортежи \alert{произведения} 
    \[P=T_1\times T_2\times\ldots\times T_n,\] 
    а после ключевого слова \verb"select" указываются имена столбцов таблиц, определяющую \alert{проекцию} отфильтнованного по условию выбора отношения $P$.
\end{frame}



В качестве примера некоторой базы данных приводятся таблицы \ref{tbl:ralg:Student}-\ref{tbl:ralg:StudentSection}. Дальнейшие примеры SQL-запросов приводятся на их основе.

\begin{frame}[fragile]
    \frametitle{Примеры SQL SELECT}
    
\begin{semiverbatim}
\uncover<1>{\alert{select} * \alert{from} Студент \alert{where} Студент.пол='Ж';}

\uncover<2>{\alert{select} Студент.фамилия \alert{from} Студент;}

\uncover<3>{
\alert{select}
    Студент.номер, Студент.имя, Студент.фамилия, 
    СекцияСтудента.НомерСекции 
\alert{from }
    Студент,СекцияСтудента 
\alert{where} Студент.Номер=СекцияСтудента.НомерСтудента;
}
\end{semiverbatim}
\end{frame}

\begin{frame}[fragile]
    \frametitle{Примеры SQL SELECT}
    
\begin{semiverbatim}
\alert{select}
    Студент.номер, Студент.имя, Студент.фамилия, 
    Студент.фамилия, Секция.Название
\alert{from}
    Студент,СекцияСтудента,Секция
\alert{where}
    Студент.Номер=СекцияСтудента.НомерСтудента \alert{and}
    СекцияСтудента.НомерСекции=Секция.номер;
\end{semiverbatim}
\end{frame}

\appendix


\begin{frame}
    \frametitle{В заключение}
    
    На практике часто сталкиваются с необходимостью долговременного хранения больших объемов данных. Обычно такая необходимость возникает в системах, регистрирующих определенные события, например: факты продаж в магазите, результаты сессии в университете, платежи в интернет-магазине, регистрация пользователей на сайтах и т.д. Регистрируемое событие можно описать кортежем количественных и качественных значений. Множество, состоящее из событий-кортежей, как уже известно, представляет собой отношение. Реляционная алгебра определяет операции над отношениями и является теоретической основой реляционных баз данных. 
    
    Формальное определение реляционной алгебры можно найти в \cite{bib:gorbatovs:discrmath,bib:haggard:discrmathprogrammer}. Тем же, кто заинтересуется практическими вопросами организации, хранения и обработки данных можно рекомендовать специализированные книги по базам данных, например, \cite{bib:krenke:db}.
\end{frame}


\begin{frame}[allowframebreaks]{Библиография}
    \bibliographystyle{gost780u}
    \bibliography{./../../bibliobase}
\end{frame}

\end{document}